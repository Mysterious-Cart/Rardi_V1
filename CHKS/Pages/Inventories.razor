@page "/inventories"

@attribute [Authorize]
@using System.Globalization
@using CHKS.Pages.Component.Popup;

<head>
    <link href="css/Page.css" rel="stylesheet"/>
</head>

<PageTitle>Inventories</PageTitle>
<RadzenRow>
    <RadzenColumn> 
        <RadzenTextBox Placeholder="Type to search" Style="width:100%" @oninput="@(args => Search(args))"/>
    </RadzenColumn>
    <RadzenColumn Size="3"> 
        <RadzenTextBox Placeholder="Filter Tag" Style="width:100%"/>
    </RadzenColumn>
    
</RadzenRow>

<RadzenRow style="margin-top:10px">
    <RadzenColumn Size="3" >
        <RadzenCard Style="box-shadow: none; height: 93dvh">
            <RadzenText Text="Product" TextStyle="TextStyle.DisplayH6" />
            <RadzenStack Gap="10px" Style="margin-top: 20px;">
                <RadzenText Text="Detail" TextStyle="TextStyle.H6"/>
                <RadzenRow>
                    <RadzenText Text="Tags:"/>
                    <RadzenButton  Icon="add" Click=@EditTags Size="ButtonSize.ExtraSmall" Variant="Variant.Outlined" Style="margin-left:auto"/>
                </RadzenRow>
                <RadzenRow>
                    <RadzenText Text="Qty: " />
                    <RadzenText Text=@(Product?.Stock.ToString("0")??"--")/>
                    <RadzenButton  Icon="add" Size="ButtonSize.ExtraSmall" Variant="Variant.Outlined" Style="margin-left:auto"/>
                </RadzenRow>
                <RadzenRow>
                    <RadzenText Text="Acquisition:"/>
                    <RadzenText Text=@(Acquisition != 0?Acquisition.ToString("$0.0"): "--") />
                </RadzenRow>
                <RadzenText Text="Traffic" TextStyle="TextStyle.H6"/>
                <RadzenRow>
                    <RadzenColumn>
                        <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Center">
                            <RadzenText Text="Total Sale:"/>
                            <RadzenText Text=@(TotalSale != 0?TotalSale.ToString(): "--") />
                        </RadzenStack>
                    </RadzenColumn>
                    <RadzenColumn>
                        <RadzenStack Orientation="Orientation.Vertical" AlignItems="AlignItems.Center">
                            <RadzenText Text="Revenue:"/>
                            <RadzenText Text=@(Revenue != 0?Revenue.ToString("$0.0"): "--")  />
                        </RadzenStack>
                    </RadzenColumn>
                    
                </RadzenRow>
            </RadzenStack>
        </RadzenCard> 
    </RadzenColumn>

    <RadzenColumn>
        
    <RadzenDataGrid @ref="grid0" AllowVirtualization="true" ColumnWidth="200px" AllowFiltering="true" FilterMode="FilterMode.Advanced"  ShowPagingSummary="true" Style="height:94dvh;  "
        Data="@inventories" RowUpdate="@GridRowUpdate" RowCreate="@GridRowCreate" RowSelect="@(args => Select_Product(args))" TItem="CHKS.Models.mydb.Inventory">
        <Columns>
            <RadzenDataGridColumn TItem="CHKS.Models.mydb.Inventory" Property="Barcode" Title="កូដ" Width="30%" OrderIndex="1">
                <EditTemplate Context="inventory">
                    <RadzenTextBox style=" width: 100%" @bind-Value="@inventory.Barcode" Name="Barcode"/>
                </EditTemplate>
            </RadzenDataGridColumn>
            <RadzenDataGridColumn TItem="CHKS.Models.mydb.Inventory" Property="Name" Title="ឈ្មោះ" Width="30%" OrderIndex="1">
                <EditTemplate Context="inventory">
                    <RadzenTextBox style="width: 100%" @bind-Value="@inventory.Name" Name="Name" />
                    <RadzenRequiredValidator Component="Name" Text="Name is required" style="position: absolute;" />
                </EditTemplate>
            </RadzenDataGridColumn>
            <RadzenDataGridColumn TItem="CHKS.Models.mydb.Inventory" Property="Stock" Title="ក្នុងស្តុក" Width="20%" FormatString="{0:0}">
                <EditTemplate Context="inventory">
                    <RadzenNumeric style="width: 100%" @bind-Value="@inventory.Stock" Name="Stock" Format="N2" ShowUpDown = "false"/>
                </EditTemplate>
            </RadzenDataGridColumn>
            <RadzenDataGridColumn TItem="CHKS.Models.mydb.Inventory" Property="Import" Title="តម្លៃទិញចូល" Width="20%" FormatString="${0:N2}">
                <EditTemplate Context="inventory">
                    <RadzenNumeric style="width: 100%" @bind-Value="@inventory.Import" Name="Import" Format="N2" ShowUpDown = "false" />
                </EditTemplate>
                <FooterTemplate>
                    <RadzenText TextStyle="TextStyle.DisplayH6">សរុបមុខទំនេញ:</RadzenText>
                </FooterTemplate>
            </RadzenDataGridColumn>
            
            <RadzenDataGridColumn TItem="CHKS.Models.mydb.Inventory" Property="Export" Title="តម្លៃលក់" Width="20%" FormatString="${0:N2}">
                <EditTemplate Context="inventory">
                    <RadzenNumeric style="width: 100%" @bind-Value="@inventory.Export" Name="Export"  Format="N2"  ShowUpDown = "false"/>
                </EditTemplate>
                <FooterTemplate>
                    <RadzenText TextStyle="TextStyle.DisplayH6"> @(inventories.Count() + " មុខ")</RadzenText>
                </FooterTemplate>
            </RadzenDataGridColumn>
            <RadzenDataGridColumn TItem="CHKS.Models.mydb.Inventory" Filterable="false" Sortable="false" Width="156px" TextAlign="TextAlign.Center">
                <EditTemplate Context="inventory">
                    <RadzenButton Icon="check" ButtonStyle="ButtonStyle.Success" Variant="Variant.Flat" Size="ButtonSize.Medium"
                        style="margin-top: 0.25rem; margin-right: 0.25rem; margin-bottom: 0.25rem"
                        Click=@(args => SaveButtonClick(args, inventory)) @onclick:stopPropagation="true" />
                    <RadzenButton Icon="close" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" Size="ButtonSize.Medium"
                        Click=@(args => CancelButtonClick(args, inventory)) @onclick:stopPropagation="true" />
                </EditTemplate>
                <Template Context="inventory">

                    <RadzenButton Icon="edit" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" Size="ButtonSize.Medium"
                        style="margin-top: 0.25rem; margin-right: 0.25rem; margin-bottom: 0.25rem"
                        Click=@(args => EditButtonClick(args, inventory)) @onclick:stopPropagation="true" />

                    <RadzenButton ButtonStyle="ButtonStyle.Danger" Icon="delete" Size="ButtonSize.Medium"
                        Shade="Shade.Lighter" Variant="Variant.Flat"
                        Click=@(args => GridDeleteButtonClick( inventory)) @onclick:stopPropagation="true" />
                </Template>
            </RadzenDataGridColumn>

        </Columns>

    </RadzenDataGrid>
    </RadzenColumn>
</RadzenRow>



@code{
    private CultureInfo Currency = new CultureInfo("en-US");
}